{% extends 'base.html' %}
{% block content %}


  <!-- Main content -->


  <div class="max-w-2xl mx-auto mt-12 bg-white rounded-lg shadow-lg p-8">
    {% if request.GET.verified == "1" %}
    <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
      Email verified successfully! You can now log in.
    </div>
  {% elif request.GET.verified == "0" %}
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
      Invalid or expired verification link.
    </div>
  {% endif %}
    <h1 class="text-3xl font-bold mb-6 text-center text-blue-700">Welcome to Channels App!</h1>

    <!-- Create Channel Form -->
    <div class="mb-8">
      <button id="toggleCreateForm" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">+ Create Channel</button>
      <form id="createChannelForm" class="mt-4 hidden space-y-4">
        <input type="text" id="channelName" class="border px-3 py-2 rounded w-full" placeholder="Channel Name" required />
        <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">Create</button>
      </form>
    </div>

    <!-- List of Created Channels -->
    <div>
      <h2 class="text-xl font-semibold mb-2">Your Channels</h2>
      <ul id="channelsList" class="space-y-2"></ul>
    </div>
  </div>


  <script>
    const toggleBtn = document.getElementById('toggleCreateForm');
    const form = document.getElementById('createChannelForm');
    const channelsList = document.getElementById('channelsList');
    const channelNameInput = document.getElementById('channelName');

    // Simple local storage for demo
    function getChannels() {
      return JSON.parse(localStorage.getItem('channels') || '[]');
    }
    function saveChannels(channels) {
      localStorage.setItem('channels', JSON.stringify(channels));
    }
    function renderChannels() {
      channelsList.innerHTML = '';
      const channels = getChannels();
      if (channels.length === 0) {
        channelsList.innerHTML = '<li class="text-gray-500">No channels created yet.</li>';
      } else {
        channels.forEach((c, idx) => {
          const li = document.createElement('li');
          li.innerHTML = `<div class="flex items-center justify-between bg-gray-200 rounded px-4 py-2">
            <span class="font-medium">${c}</span>
            <button onclick="deleteChannel(${idx})" class="text-red-500 hover:text-red-700">Delete</button>
          </div>`;
          channelsList.appendChild(li);
        });
      }
    }
    function deleteChannel(idx) {
      let channels = getChannels();
      channels.splice(idx, 1);
      saveChannels(channels);
      renderChannels();
    }
    window.deleteChannel = deleteChannel;

    toggleBtn.addEventListener('click', () => {
      form.classList.toggle('hidden');
    });

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const name = channelNameInput.value.trim();
      if (!name) return;
      let channels = getChannels();
      channels.push(name);
      saveChannels(channels);
      channelNameInput.value = '';
      form.classList.add('hidden');
      renderChannels();
    });

    // Initial render
    renderChannels();
  </script>

{% endblock  %}