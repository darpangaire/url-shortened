{% extends 'base.html' %}
{% load static %}
{% block content %}

<div class="max-w-4xl mx-auto py-10 px-4">

  <!-- Admin Post Form -->
  {% if request.user.is_staff %}
  <form action="{% url 'create_post' %}" method="POST" enctype="multipart/form-data" class="mb-8 bg-white p-6 rounded-lg shadow">
    {% csrf_token %}
    <label class="block mb-2 font-semibold">Post Image:</label>
    <input type="file" name="image" required class="mb-4 block w-full border rounded">

    <label class="block mb-2 font-semibold">Caption:</label>
    <textarea name="caption" rows="2" class="w-full border rounded p-2 mb-4"></textarea>

    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Post</button>
  </form>
  {% endif %}

  <!-- Posts List -->
  {% for post in posts %}
  <div class="bg-white rounded-lg shadow p-4 mb-6">
    <img src="{{ post.image.url }}" class="w-full rounded mb-3" alt="Post Image">
    <p class="mb-2 text-gray-800">{{ post.caption }}</p>
    <p class="text-sm text-gray-500">Posted by {{ post.author.username }} â€¢ {{ post.created_at|naturaltime }}</p>

    {% if request.user.is_staff %}
    <form method="POST" action="{% url 'delete_post' post.id %}" class="mt-2">
      {% csrf_token %}
      <button class="text-red-600 text-sm font-semibold hover:underline">Delete Post</button>
    </form>
    {% endif %}

    <!-- Comments -->
    <div class="mt-4">
      <h4 class="font-semibold mb-2 text-gray-700">Comments</h4>
      {% for comment in post.comments.all %}
      <div class="border-t pt-2 text-sm">
        <p class="text-gray-800">{{ comment.name }}:</p>
        <p class="text-gray-600">{{ comment.text }}</p>
      </div>
      {% endfor %}

      <!-- Comment Form -->
      <form method="POST" action="{% url 'comment_on_post' post.id %}" class="mt-3">
        {% csrf_token %}
        <input type="text" name="name" placeholder="Your name" class="block w-full border p-2 rounded mb-2" required>
        <textarea name="text" rows="2" placeholder="Comment..." class="block w-full border p-2 rounded mb-2" required></textarea>
        <button type="submit" class="bg-gray-700 text-white px-3 py-1 rounded text-sm">Add Comment</button>
      </form>
    </div>
  </div>
  {% endfor %}

</div>

{% endblock %}


