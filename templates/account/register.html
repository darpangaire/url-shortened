{% extends 'base.html' %}
{% load static %}
{% block content %}

<div class="bg-gradient-to-tr from-blue-50 to-purple-100 min-h-screen flex items-center justify-center">
  <div class="bg-white rounded-xl shadow-lg p-8 w-full max-w-md">
    <h2 class="text-2xl font-bold mb-4 text-center text-blue-700">Register</h2>
    <form id="registerForm" class="space-y-4">
      <div>
        <label class="block text-gray-700 mb-1" for="first_name">First Name</label>
        <input type="text" id="first_name" name="first_name" class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400" required>
      </div>
      <div>
        <label class="block text-gray-700 mb-1" for="last_name">Last Name</label>
        <input type="text" id="last_name" name="last_name" class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400" required>
      </div>
      <div>
        <label class="block text-gray-700 mb-1" for="email">Email</label>
        <input type="email" id="email" name="email" autocomplete="username" class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400" required>
      </div>
      <div>
        <label class="block text-gray-700 mb-1" for="password">Password</label>
        <input type="password" id="password" name="password" autocomplete="new-password" class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400" required>
      </div>
      <div>
        <label class="block text-gray-700 mb-1" for="password2">Confirm Password</label>
        <input type="password" id="password2" name="password2" autocomplete="new-password" class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400" required>
      </div>
      <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded font-semibold transition">Register</button>
    </form>
    <div id="formMessage" class="mt-4 text-center"></div>
  </div>
  <script>
    const form = document.getElementById('registerForm');
    const messageDiv = document.getElementById('formMessage');

    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      messageDiv.innerHTML = '';
      const data = {
        first_name: form.first_name.value,
        last_name: form.last_name.value,
        email: form.email.value,
        password: form.password.value,
        password2: form.password2.value,
      };
      try {
        const response = await fetch('/account/api-register/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-Requested-With': 'XMLHttpRequest',
            // CSRF token may be needed if not using JWT or public API
          },
          body: JSON.stringify(data),
        });
        const resData = await response.json();

        if (response.ok) {
          window.location.href = "{% url 'email_verification_alert' %}";
        } else {
          // Display errors
          let errorHtml = '<div class="text-red-600 font-semibold mb-2">Registration failed:</div>';
          if (typeof resData === 'object') {
            for (const [field, errors] of Object.entries(resData)) {
              errorHtml += `<div class="text-red-500"><span class="font-semibold">${field}:</span> ${Array.isArray(errors) ? errors.join(', ') : errors}</div>`;
            }
          } else {
            errorHtml += `<div class="text-red-500">${resData}</div>`;
          }
          messageDiv.innerHTML = errorHtml;
        }
      } catch (error) {
        messageDiv.innerHTML = `<div class="text-red-600">An error occurred. Please try again later.</div>`;
      }
    });
  </script>
</div>

{% endblock %}